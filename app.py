import streamlit as st
import streamlit.components.v1 as components
import unicodedata
import random
import re
import os

# --- ページ設定 ---
st.set_page_config(
    page_title="フヤセルプロンプト",
    page_icon="🐈",
    layout="wide",
    initial_sidebar_state="expanded" 
)

# --- 定数・データ定義 ---

MODES = {
    "📈 攻め（売買・戦略）": {
        "chars": [
            "【🟩 売買】短期売買コーチ（デイトレ・スキャル指導）",
            "【🟩 売買】スイング職人（数日〜数週間の波乗り）",
            "【🟩 売買】順張り隊長（高値更新こそ買い）",
            "【🟩 売買】逆張り名人（リバウンド狙いの鬼）",
            "【🟩 売買】エントリーポイント整理屋（根拠の言語化）",
            "【🟩 売買】ブレイクアウト狙撃手（保ち合い離れ専門）",
            "【🟩 売買】イナゴタワー登山家（急騰銘柄の飛び乗り）",
            "【🟩 売買】IPOセカンダリーハンター（直近上場株専門）",
            "【🟩 売買】低位株・ボロ株ドリーム勢（一発逆転狙い）",
            "【🟩 売買】イベント投資家（優待・昇格・TOB先回り）"
        ],
        "questions": [
            "今入っていい？（デイトレ目線）",
            "明日の寄り付きは「買い」か「様子見」か？",
            "押し目はどこ？具体的な価格で教えて",
            "チャートの形的に、上に行きそう？",
            "適切な損切りラインと利確目標は？",
            "今の株価位置は「高値圏」か「安値圏」か？",
            "MACDやRSIなどのオシレーターはどうなってる？",
            "出来高の推移から怪しい動きはある？",
            "板の雰囲気（気配値）は強い？弱い？",
            "5日移動平均線との乖離率はどう？",
            "ボリンジャーバンドのバンドウォーク中？",
            "一目均衡表の「雲」の上？下？",
            "直近の高値をブレイクする勢いはある？",
            "機関投資家の空売りが入っている可能性は？",
            "信用買残の整理状況は？（上値は重い？）",
            "もし買うなら、打診買い？全力買い？",
            "ナンピンするならどの価格帯？",
            "ピラミッティング（増し玉）するタイミングは？",
            "大口投資家が買っている痕跡はある？",
            "デイトレなら何分足を見るべき？",
            "VWAP（出来高加重平均）より上か下か？",
            "PTS（夜間取引）での動きはどう？",
            "セクター（業種）全体の資金流入はある？",
            "連動している銘柄（親子上場や同業）の動きは？",
            "材料出尽くしで売られるパターン？",
            "窓埋め（Gap fill）を狙うべき？",
            "週末持ち越し（またぎ）は危険？",
            "寄り底（朝安く引け高い）の可能性は？",
            "ストップ高張り付きを狙える勢いはある？",
            "今のトレンドはいつまで続きそう？"
        ]
    },
    "🛡️ 守り（管理・リスク）": {
        "chars": [
            "【🟥 辛口】鬼上司投資顧問（甘え一切なし）",
            "【🟥 辛口】撤退番長（逃げ遅れ許さない）",
            "【🟥 辛口】ポジポジ病矯正官（無駄エントリー叱責）",
            "【🟩 戦略】資金管理マネージャー（破産回避）",
            "【🟩 戦略】分割利確コーチ（利益確保優先）",
            "【🟩 戦略】「現金は王様」信者（キャッシュ比率重視）",
            "【🟩 戦略】ヘッジ取引の魔術師（空売り・オプション活用）",
            "【🟩 戦略】ポートフォリオ設計士（分散投資の鬼）",
            "【🟥 辛口】機会損失を嘆く亡霊（買わなかった後悔を説く）",
            "【🟥 辛口】税金計算・損益通算アドバイザー（年末調整）"
        ],
        "questions": [
            "含み損が辛い。切るべきか耐えるべきか？",
            "ナンピンしても助かる可能性はある？",
            "今の資金量に対して、適正なポジション量は？",
            "この銘柄のリスク要因を全て洗い出して",
            "最悪のシナリオ（スト安など）への対策は？",
            "どこで利確するのが一番賢い？（頭と尻尾）",
            "逆指値（ストップロス）はどこに置くべき？",
            "トレーリングストップ（追跡逆指値）の幅は？",
            "今の相場環境でフルインベストメントしていい？",
            "キャッシュポジション（現金）は何％残すべき？",
            "他の銘柄との相関関係（共倒れリスク）は？",
            "配当落ち後の下落リスクは考慮した？",
            "決算またぎのリスクリワードは合ってる？",
            "増資懸念（希薄化リスク）はある？",
            "為替変動（円高・円安）によるダメージは？",
            "地政学リスクの影響を受ける銘柄？",
            "信用維持率は安全圏？（追証リスク）",
            "「頭と尻尾はくれてやる」精神で逃げるべき？",
            "今のメンタル状態でトレードして大丈夫？",
            "大損した後のリハビリトレードはどうやる？",
            "同値撤退（手数料損のみ）で逃げるべき？",
            "部分利確（半分売るなど）の目安は？",
            "「噂で買って事実で売る」べきタイミング？",
            "流動性リスク（売りたい時に売れない）はある？",
            "監理ポスト・整理ポスト入りの危険性は？",
            "粉飾決算や不祥事の匂いはしない？",
            "SNSでの煽り（買い煽り）に騙されてない？",
            "自分の投資ルールを破っていないか確認して",
            "年間収支をプラスにするための今の最善手は？",
            "一度ノーポジションにして頭を冷やすべき？"
        ]
    },
    "📊 分析（業績・ファンダ）": {
        "chars": [
            "【🟦 分析】需給探偵（出来高・板・信用残）",
            "【🟦 分析】材料スナイパー（IR・ニュース初動）",
            "【🟦 分析】20年選手の日本株アナリスト（王道）",
            "【🟦 分析】決算職人（短信ガチ読み）",
            "【🟨 長期】バリュー株査定士（割安度判定）",
            "【🟦 分析】会社四季報の虫（全号読破・脚注マニア）",
            "【🟦 分析】マクロ経済学者（金利・為替・国債連動）",
            "【🟦 分析】インサイダー追跡班（役員売買・自社株買い）",
            "【🟦 分析】セクターローテ予報士（次の流行業種）",
            "【🟨 長期】高配当・優待生活の達人（利回り重視）"
        ],
        "questions": [
            "決算内容を、良い・悪い・中立で評価して",
            "この会社の「稼ぐ力（営業利益率）」はどう？",
            "PER・PBR・配当利回りから見て割安？",
            "機関投資家の動きや空売り残高はどうなってる？",
            "ライバル企業（競合他社）と比較した強みは？",
            "来期の業績予想（ガイダンス）は保守的？",
            "コンセンサス（市場予想）を超えそう？",
            "進捗率は順調？（1Q, 2Q, 3Qの季節性は？）",
            "貸借対照表（BS）に危ない項目はない？",
            "キャッシュフロー（CF）は健全に回ってる？",
            "自己資本比率は安全圏？倒産確率は？",
            "中期経営計画の達成可能性はどれくらい？",
            "新しいビジネスモデルや新製品の将来性は？",
            "円安・円高、どっちがメリットの会社？",
            "原油高や資源価格の影響は受ける？",
            "海外売上比率はどれくらい？成長余地は？",
            "大株主に有名なファンドや投資家はいる？",
            "自社株買いや増配の余力はある？",
            "株主優待の廃止リスク（改悪）はある？",
            "過去のチャートの癖（アノマリー）はある？",
            "日経平均やTOPIXとの連動性（β値）は？",
            "「隠れ優良銘柄」としてのポテンシャルは？",
            "M&Aによる成長、または買収される可能性は？",
            "社長や経営陣の評判・手腕はどう？",
            "従業員の口コミ（働きやすさ）は株価に関係する？",
            "ESG（環境・社会・ガバナンス）への取り組みは？",
            "特定株（浮動株の少なさ）による値動きの特徴は？",
            "今の株価は将来の成長を織り込み済み？",
            "理論株価（フェアバリュー）はいくら？",
            "10年持ってて枕を高くして眠れる銘柄？"
        ]
    },
    "🔰 初心者・メンタル": {
        "chars": [
            "【🟪 初心】投資を噛み砕く先生（図解気分）",
            "【🟪 メンタル】感情整理カウンセラー（恐怖ケア）",
            "【🟪 メンタル】「今日は休め」と言う人（休むも相場）",
            "【🟫 遊び】逆神おじさん（反面教師）",
            "【🟪 初心】専門用語禁止の優しい先輩",
            "【🟪 メンタル】褒めちぎり隊長（自己肯定感爆上げ）",
            "【🟪 初心】歴史の先生（バブルや恐慌の歴史から学ぶ）",
            "【🟫 遊び】フヤにゃん（ただただ癒やす猫型ロボ）",
            "【🟪 メンタル】瞑想・マインドフルネス導入係（深呼吸）",
            "【🟪 初心】積立NISAとの比較お姉さん（長期目線）"
        ],
        "questions": [
            "この銘柄、初心者でも買って大丈夫？",
            "専門用語が多すぎて分からない！噛み砕いて！",
            "メンタルがボロボロ。とにかく励まして...",
            "投資の勉強として、この銘柄から何を学べる？",
            "私の考え、間違ってないか優しくチェックして",
            "株価が下がって怖い！どう考えればいい？",
            "株価が上がって興奮して眠れない！落ち着かせて！",
            "「押し目」とか「逆張り」って何？",
            "配当金や優待をもらうにはいつまでに買えばいい？",
            "100株買うのにいくら必要か計算して！",
            "NISA枠（成長投資枠）で買うのに向いてる？",
            "借金して株をやっちゃダメな理由は？",
            "損切りできない私の背中を押して（優しく）",
            "利益が出たけど、税金ってどうなるの？",
            "株主総会って行くと何があるの？",
            "ニュースを見ても意味不明。何を見ればいい？",
            "周りが儲かってて焦る。どうすればいい？",
            "この銘柄、子供に残せるような良い会社？",
            "ギャンブルと投資の違いを教えて",
            "1日何回くらい株価チェックすればいい？",
            "ポジポジ病を治すための精神統一方法は？",
            "損した分を取り返そうとしちゃダメ？",
            "プロでも負けることはあるの？",
            "株主優待だけで生活するって可能なの？",
            "チャートのローソク足の見方を教えて",
            "出来高って何？なんで重要なの？",
            "株価ボードの色の意味（赤・緑）は？",
            "SNSの「爆益報告」を見て落ち込む必要ある？",
            "フヤにゃん的に、この銘柄好き？",
            "明日も株式市場は開いてるの？（休場日確認）"
        ]
    },
    "🚑 緊急・特別対応": {
        "chars": [
            "【🟥 辛口】冷徹ファンドPM（数字以外信じない）",
            "【🟥 辛口】楽観論クラッシャー（最悪を想定）",
            "【🟨 長期】決算跨ぎ判断役（持ち越すべきか）",
            "【🟫 遊び】最後に現実を突きつける監督",
            "【🚑 緊急】外科医・損切りドクター（緊急手術）",
            "【🚑 緊急】PTS・ADR監視員（夜間の先読み）",
            "【🚑 緊急】開示情報の弁護士（悪材料の行間を読む）",
            "【🚑 緊急】流動性パニック対策係（売り抜け判断）",
            "【🟫 遊び】お祈り投資法の教祖（神頼み）"
        ],
        "questions": [
            "暴落中！今すぐ逃げるべきか、拾うべきか？",
            "決算またぎ、ギャンブルしてもいい？",
            "悪材料が出たけど、どこまで下がる（値幅）？",
            "ストップ安で売れない！明日はどうなる？",
            "大暴落の歴史（リーマン等）と比べてどう？",
            "不正会計のニュースが出た！倒産する？",
            "TOB（公開買付）された！どうすればいい？",
            "上場廃止が決まったら株はどうなるの？",
            "追証（おいしょう）が発生しそう！対処法は？",
            "急騰しすぎて怖い。天井のサインは？",
            "「監理銘柄」に指定されたけど大丈夫？",
            "社長が逮捕された！株価への影響は？",
            "戦争や災害発生！全体相場への影響は？",
            "サーキットブレイカー発動！どう振る舞う？",
            "日銀のサプライズ利上げ！銀行株はどうなる？",
            "為替介入が入った！輸出関連株は逃げるべき？",
            "増資（公募増資）発表！暴落を拾うべき？",
            "株主優待の改悪発表！明日売るべき？",
            "減配（無配転落）発表！見限るべき？",
            "自社株買い終了のお知らせ…売りサイン？",
            "逆日歩（品貸料）がすごいことに！買い戻すべき？",
            "仕手株の最後（ナイアガラ）に巻き込まれた！",
            "誤発注しちゃった！取り消し間に合う？",
            "証券会社のサーバーがダウン！どうすれば？",
            "ログインパスワード忘れた（緊急事態）！",
            "四季報予想より遥かに悪い決算…どう解釈する？",
            "コンセンサス未達だけど株価は上がりそう？",
            "海外ヘッジファンドが売り仕掛けしてる噂は本当？",
            "今、冷静な判断ができているかチェックして",
            "最悪、全額失っても生きていける？（生存確認）"
        ]
    },
    "📚 学習（知識・歴史）": {
        "chars": [
            "【📚 学習】恩株づくりの職人（元本回収のプロ）", 
            "【📚 学習】投資の歴史教授（バブルと暴落の歴史）",
            "【📚 学習】テクニカル分析の教科書（基本から応用）",
            "【📚 学習】ファンダメンタルズの鬼教師（財務諸表）",
            "【📚 学習】行動経済学の研究者（投資家心理とバイアス）",
            "【📚 学習】伝説の相場師シミュレーター（古の知恵）",
            "【📚 学習】金融用語の辞書（わかりやすく解説）",
            "【📚 学習】マクロ経済の講師（金利・為替と株価）",
            "【📚 学習】クイズ出題者（理解度チェック）",
            "【📚 学習】洋書投資本の翻訳家（海外の知恵）",
            "【📚 学習】失敗事例アーカイブ（他人の損から学ぶ）"
        ],
        "questions": [
            "恩株（タダ株）の作り方を教えて（2倍にならなくても作る方法）",
            "「PER」「PBR」「ROE」をわかりやすく教えて",
            "チャートの「ゴールデンクロス」って本当に効くの？",
            "ローソク足の「酒田五法」について教えて",
            "「ダウ理論」って何？現代でも通用する？",
            "機関投資家と個人投資家の決定的な違いは？",
            "「空売り」の仕組みを子供でもわかるように教えて",
            "バブル崩壊の前兆にはどんなサインがある？",
            "リーマンショックの時、市場はどう動いた？",
            "有名な投資家（バフェット等）の投資哲学を知りたい",
            "「プロスペクト理論」って投資にどう関係する？",
            "損切りができない心理（サンクコスト）の克服法は？",
            "「板読み」の基本的なやり方を教えて",
            "決算短信のどこを最初に見るべき？",
            "四季報の読み解き方をレクチャーして",
            "金利が上がると株価が下がるのはなぜ？",
            "円安になると株価はどうなる？（メリット・デメリット）",
            "「インデックス投資」と「個別株投資」の違いは？",
            "投資信託とETF、どっちがいいの？",
            "NISAとiDeCo、制度の違いを整理して",
            "「複利効果」の凄さをシミュレーションして",
            "「リスク」と「リターン」の関係（シャープレシオ等）は？",
            "暴落時にやってはいけない行動トップ3は？",
            "投資初心者が最初に読むべき本を3冊教えて",
            "自分のリスク許容度を知るための質問をして",
            "「分散投資」の具体的なポートフォリオ例を見せて",
            "デイトレードと長期投資、向いている性格は？",
            "株主優待の仕組みと、権利確定日の注意点は？",
            "「信用取引」のリスクを具体的に教えて",
            "IPO（新規公開株）の抽選の仕組みは？",
            "投資日記（トレード記録）の効果的なつけ方は？"
        ]
    },
    "📰 記事・ニュース入力": {
        "chars": [
            "【📰 記事】要約のプロ（3行でまとめる）",
            "【📰 記事】辛口コメンテーター（批判的に読む）",
            "【📰 記事】ポジティブ変換機（良い点を探す）",
            "【📰 記事】銘柄抽出マシーン（関連銘柄をリスト化）",
            "【📰 記事】小学生にもわかる解説（平易な言葉で）",
            "【📰 記事】見出し職人（キャッチーなタイトル作成）",
            "【📰 記事】フェイクニュース検知器（信憑性チェック）",
            "【📰 記事】海外記事の翻訳・解説（背景知識補足）",
            "【📰 記事】議論のファシリテーター（論点整理）",
            "【📰 記事】フヤにゃん（感想を言う）"
        ],
        "questions": [
            "この記事を3行で要約して",
            "小学生でもわかるように簡単にして",
            "記事に出てくる銘柄は「買い」か「売り」か？",
            "この記事の重要なポイントを3つ挙げて",
            "筆者の主張に矛盾点はない？",
            "この記事から読み取れる今後のトレンドは？",
            "専門用語を解説して",
            "この記事はポジティブ？ネガティブ？",
            "次に起こりそうな展開を予測して",
            "この記事の信憑性は？"
        ]
    }
}

TIME_HORIZONS = [
    "指定なし",
    "超短期（デイトレ・当日）",
    "短期（数日〜数週間）",
    "中期（数ヶ月〜半年）",
    "長期（1年〜3年）",
    "超長期（永久保有）"
]

STATUS_OPTIONS = [
    "未保有（これから買いたい）",
    "保有中（含み益でホクホク）",
    "保有中（含み損でツライ）",
    "監視中（チャンス待ち）",
    "勉強中（ポジションなし）"
]

# --- 関数群 ---

def clean_tickers(text):
    if not text: return []
    normalized_text = unicodedata.normalize('NFKC', text)
    tokens = re.split(r'[,\s\n]+', normalized_text)
    return [t.upper() for t in tokens if t]

def copy_button_component(text_to_copy):
    """
    左寄せでサイズ小さめのコピーボタン
    """
    escaped_text = text_to_copy.replace("\\", "\\\\").replace("`", "\\`").replace("$", "\\$")
    js_code = f"""
    <script>
    function copyText() {{
        const textToCopy = `{escaped_text}`;
        navigator.clipboard.writeText(textToCopy).then(function() {{
            const btn = document.getElementById("copyBtn");
            btn.innerText = "✅ コピー完了！";
            btn.style.backgroundColor = "#e0ffe0";
            setTimeout(() => {{
                btn.innerText = "📋 コピーする";
                btn.style.backgroundColor = "#ffffff";
            }}, 2000);
        }});
    }}
    </script>
    <div style="text-align: left; margin-top: 5px;">
        <button id="copyBtn" onclick="copyText()" style="
            width: auto;
            min-width: 140px;
            background-color: #ffffff; 
            border: 1px solid #d6d6d8; 
            border-radius: 6px; 
            padding: 8px 16px; 
            font-size: 14px;
            font-weight: 600;
            cursor: pointer; 
            color: #31333F;">
            📋 コピーする
        </button>
    </div>
    """
    components.html(js_code, height=60)

# --- Session State 初期化 ---
if 'selected_mode' not in st.session_state:
    st.session_state['selected_mode'] = list(MODES.keys())[0]

# --- サイドバー（ボタン式モード選択） ---

st.sidebar.title("🐈 設定")
st.sidebar.markdown("### 分析モード")

# ラジオボタンの代わりに、ボタンを並べて表示します
for mode_name in MODES.keys():
    button_type = "primary" if st.session_state['selected_mode'] == mode_name else "secondary"
    if st.sidebar.button(mode_name, type=button_type, use_container_width=True):
        st.session_state['selected_mode'] = mode_name
        st.rerun()

# 選択されたモードのデータを取得
current_mode_data = MODES[st.session_state['selected_mode']]
selected_mode_name = st.session_state['selected_mode']

# --- メイン画面 ---

col_top_img, col_top_title = st.columns([1, 4], gap="medium")

with col_top_img:
    # 画像は普通に表示します（クリック不可・huya.png）
    image_file_name = "huya.png"
    if os.path.exists(image_file_name):
        st.image(image_file_name, width=320)
    else:
        st.image("https://cdn-icons-png.flaticon.com/512/616/616430.png", width=150, caption="画像置いてにゃ")

with col_top_title:
    st.title(f"フヤセルプロンプト")
    st.subheader(f"〜 {selected_mode_name}編 〜")


# フォームエリア（縦並び）
with st.container():
    
    # 1. キャラクター選択エリア
    col_rand, col_reset = st.columns([1, 1])
    with col_rand:
        if st.button("🎲 キャラをランダムにする", use_container_width=True):
            st.session_state['rand_char_idx'] = random.randint(0, len(current_mode_data["chars"]) - 1)
    
    with col_reset:
        if st.button("🔄 ページを初期化（更新）", type="secondary", use_container_width=True):
            st.session_state.clear()
            st.rerun()

    idx = st.session_state.get('rand_char_idx', 0)
    if idx >= len(current_mode_data["chars"]): idx = 0
    
    selected_char_preset = st.selectbox(
        "担当キャラクター",
        current_mode_data["chars"],
        index=idx
    )
    custom_char_input = st.text_input(
        "👆 リストにない場合は自分で設定（入力すると優先されます）",
        placeholder="例：猫語で話すウォーレン・バフェット、とにかく褒めてくれるお母さん など"
    )
    final_char = custom_char_input if custom_char_input else selected_char_preset


    # 2. 質問選択エリア
    st.markdown("---")
    
    selected_q_preset = st.selectbox(
        "聞きたいこと（メイン）",
        current_mode_data["questions"]
    )
    custom_q_input = st.text_input(
        "👆 リストにない場合は自分で設定（入力すると優先されます）",
        placeholder="例：この銘柄の隠れたリスクを3つ挙げて、次の決算の注目点は？ など"
    )
    final_q = custom_q_input if custom_q_input else selected_q_preset


    # 3. 状態・時間軸（※記事入力モードのときは隠す！）
    is_article_mode = (selected_mode_name == "📰 記事・ニュース入力")
    
    status = ""
    time_horizon = ""
    target_display = ""
    explicit_tickers = []

    if not is_article_mode:
        with st.expander("⏱️ 時間軸・ポジション設定（任意）"):
            time_horizon = st.selectbox("時間軸", TIME_HORIZONS)
            status = st.selectbox("現在の状態", STATUS_OPTIONS)

    # 4. 入力エリア
    st.markdown("👇 **情報入力エリア**")

    # 証券コード欄（記事モードのときは隠す！）
    if not is_article_mode:
        ticker_input = st.text_input(
            "証券コード / 社名（任意・大文字小文字OK）", 
            placeholder="例：7203, sony（空欄でもOK）"
        )
        explicit_tickers = clean_tickers(ticker_input)
        target_display = ", ".join(explicit_tickers) if explicit_tickers else "（以下のテキストデータ参照）"
    else:
        target_display = "記事・ニュース内に登場する銘柄、または記事そのもの"

    # 詳細テキストエリア
    area_label = "ニュース記事本文・URL・心の叫び（長文・コピペOK！）" if is_article_mode else "ニュース・記事・心の叫び（長文・コピペOK！）"
    
    detail_input = st.text_area(
        area_label,
        height=300, 
        placeholder="例：\nここにニュース記事を全文貼り付けて、要約してもらうこともできます。\n"
    )

    # 5. 生成ボタン
    generate_btn = st.button("🚀 プロンプトを生成する", type="primary", use_container_width=True)

# --- 生成ロジック ---

if generate_btn:
    has_input = detail_input.strip() or (not is_article_mode and explicit_tickers)
    
    if not has_input:
        st.error("フヤにゃん「にゃーん！何も入力されてないにゃ😿 コードか、記事か、何か入れてほしいにゃ…」")
    else:
        prompt = f"""
# あなたへの指令
あなたは**「{final_char}」**です。
その性格、専門性、口調を完璧に再現し、以下のユーザーの相談に乗ってください。

## ユーザー情報・相談内容
"""
        if not is_article_mode:
             prompt += f"""- **現在の状態**: {status}
- **投資の時間軸**: {time_horizon}
"""
             
        prompt += f"""- **聞きたいこと**: {final_q}

## 対象
{target_display}

## 入力データ（ニュース・記事・メモ）
{detail_input}

## 回答のルール
1. **結論から書く**: 最初にズバリと回答してください。
2. **根拠を示す**: なぜそう判断したのか、論理的（または感情的）な理由を述べてください。
3. **キャラを貫く**: 指定されたキャラクターとして、ターゲット読者に刺さる言葉選びをしてください。
4. **形式**: 読みやすいマークダウン形式（重要な数値は**太字**）
"""
        st.session_state.generated_prompt = prompt
        st.success("生成完了にゃ！下のボタンでコピーして使ってね🐾")

# --- 結果表示エリア ---

if 'generated_prompt' in st.session_state and st.session_state.generated_prompt:
    st.markdown("---")
    st.subheader("📝 生成されたプロンプト")
    
    # 1. 標準コピー
    st.code(st.session_state.generated_prompt, language="markdown")
    
    # 2. 左寄せ小型コピーボタン
    copy_button_component(st.session_state.generated_prompt)
