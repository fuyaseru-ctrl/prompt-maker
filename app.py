import streamlit as st

# --- ページ設定 ---
st.set_page_config(page_title="AIプロンプト製造機", page_icon="🚀", layout="wide")

# --- タイトルエリア ---
st.title("🚀 AIプロンプト製造機")
st.write("▼ 下のボタンから「やりたいこと」を選んでください。")

# --- 1. キャラクター定義（超拡充版） ---
# カテゴリごとにリスト化
chars_entry = [
    "順張り隊長（上昇トレンドの初動しか狙わない）",
    "逆張り名人（暴落のリバウンド狙い専門）",
    "チャート職人（移動平均線とローソク足の形が全て）",
    "材料スナイパー（好材料が出た瞬間の飛び乗り専門）",
    "テーマ株レーダー（国策・流行り廃りを先読みする）",
    "需給探偵（機関の空売りと信用買い残を読み解く）",
    "ブレイクアウトハンター（高値更新の瞬間だけ狙う）",
    "押し目待ちの達人（調整局面まで絶対手を出さない）",
    "低位株ギャンブラー（一発逆転の大相場狙い）",
    "IPOセカンダリー専門家（上場直後の値動き攻略）",
    "出来高ウォッチャー（バイイングクライマックスを見抜く）"
]

chars_manage = [
    "リスク管理官（損切りライン未設定なら即却下）",
    "資金管理マネージャー（破産しないロット数を計算する）",
    "分割利確コーチ（頭と尻尾はくれてやる精神）",
    "高値掴み防止係（「本当にそこでいいの？」と止める）",
    "ポジポジ病治療医（無駄なエントリーを厳しく叱る）",
    "メンタル守護神（恐怖と欲望をコントロールする）",
    "初心者保護官（難しい専門用語を使わず導く）",
    "ルール厳守の鬼軍曹（感情による売買を許さない）",
    "建玉操作の魔術師（うねり取り・分割売買のプロ）",
    "相場ノート添削係（負けたトレードから反省点を抽出）"
]

chars_analysis = [
    "決算職人（決算短信と補足資料を隅々まで読む）",
    "グロース鑑定士（PSRと成長率で将来株価を弾く）",
    "バリュー査定士（解散価値・PBR1倍割れを許さない）",
    "配当・優待ガチ勢（利回りと権利落ち日の戦略家）",
    "IR翻訳マン（経営者のポエムを実務翻訳する）",
    "中期経営計画の査定員（絵に描いた餅か本気か見抜く）",
    "セクター分析官（半導体・銀行など循環物色を読む）",
    "円安・円高メリット判定員（為替感応度を分析）",
    "機関投資家のプロファイラー（大口の手口を推測）",
    "上級者専用ツッコミ役（「その前提、甘くない？」）"
]

chars_emergency = [
    "暴落サバイバー（セリクラ判定と生存戦略のプロ）",
    "決算シーズン警戒役（跨ぐべきか降りるべきかの審判）",
    "ショック安専門医（パニック売りの中でお宝を探す）",
    "増資・悪材料の解説員（希薄化懸念と今後の展開を読む）",
    "地合い番長（日経平均・マザーズの空気だけ読む）",
    "有事の金・原油番人（コモディティ関連の専門家）"
]

# --- 2. 質問テンプレート定義（100本ノック級・カテゴリ分け） ---

# 🔴 売買・エントリー用
q_entry_short = [
    "この株、デイトレ目線で今入っていい？",
    "明日の寄り付きは「買い」？それとも「様子見」？",
    "今のチャート、上に行きそう？下に行きそう？",
    "エントリーするなら、指値はいくらがベスト？",
    "今買うと「高値掴み」になるリスクはある？",
    "ゴールデンクロスしそうだけど、ダマシじゃない？",
    "出来高が急増している理由と、これからの動きは？",
    "板の気配値を見て、強気か弱気か判断して",
    "MACDとRSIだけで見ると、今は買い時？",
    "このニュースで明日S高する可能性はある？"
]
q_entry_swing = [
    "数日〜数週間のスイング目線で評価して",
    "上昇トレンドはまだ続くと見ていい？",
    "押し目はどこ？具体的な価格で教えて",
    "週足チャートでの重要ラインを教えて",
    "信用買い残が多いけど、上値は重い？",
    "機関投資家の空売りが入っているか確認して",
    "次の決算まで持っておくべき銘柄？",
    "セクターの資金循環から見て、今は買い？",
    "競合他社と比べて、この株の優位性は？",
    "チャートの形（酒田五法など）から分析して"
]

# 🛡️ 管理・メンタル用
q_manage_risk = [
    "適切な損切り（逆指値）ラインはどこ？",
    "利確の目標値（第一、第二）を計算して",
    "含み損が辛い。損切りすべきか、耐えるべきか？",
    "ナンピンしても助かる可能性はある？",
    "今の資金量に対して、適正な株数は何株？",
    "リスクリワード比（損失：利益）は合ってる？",
    "このポジション、週末に持ち越して大丈夫？",
    "トレードの勝率を上げるために何が足りない？",
    "連敗続きで辛い。メンタルを立て直す言葉を",
    "「休むも相場」今の地合いは休むべき？"
]

# 📊 分析・ファンダ用
q_analysis_biz = [
    "直近の決算内容を、良い・悪い・中立で評価して",
    "売上高と営業利益の伸び率（成長性）はどう？",
    "この会社の「稼ぐ力（営業利益率）」は高い？",
    "ライバル企業と比較して、勝っている点は？",
    "将来性（AI、半導体など）はあるテーマ？",
    "PER・PBRから見て、今は割安？割高？",
    "配当利回りは魅力的？減配のリスクは？",
    "株主優待はお得？廃止のリスクはない？",
    "外国人投資家が買いそうな銘柄？",
    "中期経営計画の目標達成は現実的？"
]

# 🚑 緊急・イベント用
q_emergency_crash = [
    "暴落中！今すぐ逃げるべき？それとも拾うべき？",
    "セリングクライマックス（大底）の兆候はある？",
    "追証回避のために、どこまで下がったらヤバい？",
    "この悪材料（不祥事など）、どこまで下がる？",
    "日経平均が暴落してるけど、この株への影響は？",
    "円高（円安）が急に進んだ。この株にプラス？マイナス？",
    "戦争・地政学リスク発生。まず何をすべき？",
    "ストップ安で売れない！明日の対処法は？"
]
q_emergency_earnings = [
    "決算発表またぎ、勝負してもいい？（リスク判定）",
    "コンセンサス（市場予想）を超えられそう？",
    "好決算なのに暴落する「出尽くし売り」の可能性は？",
    "悪決算でも「悪材料出尽くし」で上がる可能性は？",
    "決算資料のどこを重点的にチェックすればいい？",
    "来期のガイダンス（業績予想）は弱気になりそう？"
]


# --- 内部ターゲット設定 ---
target_audience = "株式投資に取り組む個人投資家（年齢層高め・経験豊富・実益重視）。表面的な情報よりも、具体的な根拠や示唆に富んだ内容、相場格言や経験則を好む。"

# --- メインメニュー（ボタン式ナビゲーション） ---
# st.radioを横並びにしてボタン風に見せる
menu = st.radio(
    "▼ モード選択",
    ["📈 売買・エントリー", "🛡️ 管理・メンタル", "📊 分析・ファンダ", "🚑 緊急・イベント（特別対応）"],
    horizontal=True,
    index=0
)

st.markdown("---")

# --- ロジック関数 ---
def get_prompt_content(mode_name):
    char_list = []
    template_groups = {} # { "グループ名": [質問リスト] }
    
    if mode_name == "📈 売買・エントリー":
        char_list = chars_entry
        template_groups = {
            "短期・デイトレ": q_entry_short,
            "スイング・波乗り": q_entry_swing
        }
    elif mode_name == "🛡️ 管理・メンタル":
        char_list = chars_manage
        template_groups = {
            "資金・リスク管理": q_manage_risk,
            "メンタル・心構え": ["感情的になりそうな時の対処法は？", "プロならこの場面どう考える？"] # 簡易追加
        }
    elif mode_name == "📊 分析・ファンダ":
        char_list = chars_analysis
        template_groups = {
            "業績・ファンダ": q_analysis_biz,
            "材料・テーマ性": ["このニュースのインパクトは？", "国策銘柄と言える？", "特需は一時的？長期的？"]
        }
    elif mode_name == "🚑 緊急・イベント（特別対応）":
        char_list = chars_emergency
        template_groups = {
            "🚨 暴落・ショック対応": q_emergency_crash,
            "📅 決算シーズン対応": q_emergency_earnings
        }

    return char_list, template_groups

# --- 画面描画 ---
current_chars, current_templates = get_prompt_content(menu)

col1, col2 = st.columns([1, 1])

with col1:
    st.info(f"**選択中のモード：{menu}**")
    # キャラクター選択
    selected_role = st.selectbox("1. 担当者（キャラクター）を選んでください", current_chars)

with col2:
    # 質問テンプレート選択（グループ化して見やすく）
    # セレクトボックスを見やすく整形
    template_options = ["（自分で入力する）"]
    for group_name, q_list in current_templates.items():
        for q in q_list:
            template_options.append(f"【{group_name}】 {q}")
            
    selected_template_raw = st.selectbox("2. 質問したいことをリストから選べます", template_options)

# 質問文の抽出
selected_question_body = ""
if selected_template_raw != "（自分で入力する）":
    # 【グループ名】を除去
    selected_question_body = selected_template_raw.split("】 ")[1]

# 自由入力エリア
input_text = st.text_area(
    "3. 銘柄名やニュース、補足情報を入力してください（必須）",
    height=150,
    placeholder="例：7203 トヨタ。日足チャートを見て迷っています。\n例：決算が出たので分析してほしい。内容は以下の通り...",
    value=""
)

# 生成ボタン
if st.button("🚀 プロンプトを生成する（ここをクリック）", type="primary"):
    if input_text:
        # 質問文の結合
        final_request = ""
        if selected_question_body:
            final_request = f"### 主な質問内容\n{selected_question_body}\n\n### 対象・補足情報\n{input_text}"
        else:
            final_request = input_text
            
        # プロンプト作成
        prompt = f"""
# 命令書
あなたは「{selected_role}」になりきってください。
以下のターゲットに向けた、最高品質の回答を出力してください。

## ターゲット読者
{target_audience}

## 依頼内容
{final_request}

## 制約条件
- **文体**: キャラクターの性格を反映しつつ、投資家として納得感のあるプロの口調
- **内容**: 初心者向けの薄い内容ではなく、実践的で深みのある洞察を含めること
- **出力形式**: 読みやすいマークダウン形式（重要な数字や結論は太字にする）

## 出力
"""
        st.success("✨ プロンプトが完成しました！")
        st.code(prompt, language="markdown")
        st.info("👆 右上のコピーボタンを押して、ChatGPTやClaudeに貼り付けてください。")
        
    else:
        st.error("⚠️ 「3. 銘柄名や補足情報」を入力してください！フヤにゃん困っちゃうにゃ。")
